<!-- TITLE: M201 -->
<!-- SUBTITLE: M201 Performance -->

# Overview
Does not include tuning and sizing.

Requires a local database: `docker run --name mongodb-m201 -p 27017:27017 -d mongo:latest`:
```
mongo
use m201;
exit

mongoimport -d m201 -c people ./people.json
```

# Lessons
## Hardware Considerations
RAM is 25 times fatser SSD, which up to  5 times faster than HDD.

MongoDB works best when everything runs in RAM.

WiredTigfer protocol benefits from a multi-threaded CPU.

MongoDB recommends RAID10 if usning RAID. MongoDB discourage RAID5 and RAID6 (has good redundancy but not performance) and RAID0 (has good performance but no redundancy). MongoDB also recommend using separate disks for OS, logs, indexes and data.

As a distrubted database, MongoDB is dependent on network IO, with primary/secondary cluster nodes, read replicas and shards. The network IO plays heavily into `Write Concern` and `Read Concern` controlled via the application's client connection via the driver.

## Indexes
Indexes improve the response on slow queries. Think of database indexes the same the _index_ in a book, or key/value pairs.

When a query has to look inside the documents on a collection, it is called a **collection scan** (equivalent to a "table scan" in RDBMS). It's a linear operation; the more documents to scan, the longer it takes. A collection scan is an "Order of N" operations; written as **O(N)**.

An index is automatically created on `_id` for every collection.

A MongoDB index is sorted and is stored as a "B-Tree" (https://dzone.com/articles/effective-mongodb-indexing-part-1). 

Indexes are not free. Write performance degrades, because indexes have to be updated when inserting/updating documents, and sometimes it is necessary re-balance the index. Be careful not to have unnecessary indexes (regularly review your indexes).

### Disk Storage
Two main storage engines:
* MMPA V1
* WiredTiger

We have databases which contain collections; collections group documents. Indexes operate over a single collection.

When MongoDB is launched, it is given the data and log paths: `mongod --dbpath /data/db --fork --logpath /data/db/mongodb.log`. Each index is written to a separate file. Each collection is written to a separate file.

When `mongod` starts up, it writes a collectoin files. One being `_mdb_catalog.wt` which references all the files created, including the collections and indexes.

`--directoryperdb` command line option uses separate directory for each MongoDB database; `admin` and `local` are two databases always created to manage the MongoDB instance. With this option, the collection and indexe files are contained in separate directories. And when starting `mongod` with the `--wiredTigerDirectoryForIndexes` collections and indexes are stored in separate directories:

* `/data/db`
	* `/hello`
		* `/collections`
		* `/indexes`




# Exercises
